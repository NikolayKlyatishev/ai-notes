# Инструкция по установке и использованию

## Установка

### Требования

- Python 3.8 или выше
- Микрофон
- PortAudio (для работы с PyAudio)

### Способы установки

#### 1. Стандартная установка (разработка)

1. Клонируйте репозиторий:

```
git clone https://github.com/yourusername/auto-notes.git
cd auto-notes
```

2. Создайте и активируйте виртуальное окружение:

```
# Linux/macOS
python -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

3. Установите зависимости:

```
pip install -r requirements.txt
```

#### 2. Быстрый запуск с помощью скриптов (рекомендуется)

Проект включает специальные скрипты для быстрого запуска, которые автоматически проверяют наличие Python, создают виртуальное окружение и устанавливают зависимости:

```
# Linux/macOS
./run.sh recorder    # запуск рекордера
./run.sh web         # запуск веб-интерфейса
./run.sh build       # сборка исполняемых файлов
./run.sh help        # показать справку
./run_all.sh         # запуск всех компонентов системы одновременно

# Windows
run.bat recorder     # запуск рекордера
run.bat web          # запуск веб-интерфейса
run.bat build        # сборка исполняемых файлов
run.bat help         # показать справку
run_all.bat          # запуск всех компонентов системы одновременно
```

При первом запуске скрипты предложат создать виртуальное окружение и установить зависимости.

#### 3. Установка с помощью Make

```
# Создание виртуального окружения и установка зависимостей
make setup

# Только установка зависимостей
make install
```

#### 4. Установка через pip

```
# Установка из репозитория GitHub
pip install git+https://github.com/yourusername/auto-notes.git

# Установка из локальной директории
pip install -e .
```

#### 5. Использование Docker

```
# Сборка образа
docker build -t ai-notes .

# Запуск веб-интерфейса
docker run -p 8000:8000 -v ./audio:/app/audio -v ./notes:/app/notes ai-notes

# Запуск записи аудио
docker run --device /dev/snd:/dev/snd -v ./audio:/app/audio -v ./notes:/app/notes ai-notes python recorder.py --start
```

#### 6. Использование Docker Compose для сервисного режима

```
# Запуск веб-интерфейса в режиме сервиса
docker-compose up -d webapp

# Запуск рекордера в режиме сервиса
docker-compose --profile recording up -d recorder

# Запуск всех сервисов одновременно
docker-compose --profile recording up -d

# Просмотр логов
docker-compose logs -f

# Остановка сервисов
docker-compose stop
```

Для удобства управления сервисами вы можете использовать скрипт `docker-service.sh`:

```
# Запуск всех сервисов
./docker-service.sh start-all

# Запуск только веб-интерфейса
./docker-service.sh start-web

# Запуск только рекордера
./docker-service.sh start-recorder

# Просмотр логов веб-интерфейса
./docker-service.sh logs-web

# Остановка всех сервисов
./docker-service.sh stop-all

# Просмотр всех доступных команд
./docker-service.sh help
```

Особенности работы в сервисном режиме:

- Сервисы настроены на автоматический перезапуск при сбоях
- Рекордер запускается в непрерывном режиме записи
- Все логи сохраняются для дальнейшего анализа
- Healthcheck автоматически проверяет доступность веб-интерфейса

## Использование

### Запись аудио и транскрибация

Для запуска записи есть несколько способов:

```
# Вариант 1: Через скрипты
./run.sh recorder       # Linux/macOS
run.bat recorder        # Windows

# Вариант 2: Прямой запуск
python recorder.py --start

# Вариант 3: Через Make
make run

# Вариант 4: Через установленный пакет
ai-notes-recorder --start
```

Для запуска записи в непрерывном режиме:

```
# Вариант 1: Через скрипты
./run.sh recorder-continuous  # Linux/macOS
run.bat recorder-continuous   # Windows

# Вариант 2: Прямой запуск
python recorder.py --start --continuous

# Вариант 3: Через Make
make run-continuous
```

Для использования конкретной модели Whisper:

```
python recorder.py --start --model tiny
```

Доступные модели:

- `tiny` - самая маленькая, быстрая но менее точная
- `base` - базовая модель (по умолчанию)
- `small` - улучшенная точность
- `medium` - высокая точность
- `large` - наивысшая точность (требует больше ресурсов)

### Поиск по заметкам через командную строку

```
python search.py --query "ключевое слово" --date-from 2023-01-01 --date-to 2023-12-31
```

Параметры:

- `--query` или `-q`: Ключевые слова для поиска
- `--date-from` или `-f`: Начальная дата (YYYY-MM-DD)
- `--date-to` или `-t`: Конечная дата (YYYY-MM-DD)

### Веб-интерфейс для поиска

Несколько вариантов запуска:

```
# Вариант 1: Через скрипты
./run.sh web       # Linux/macOS
run.bat web        # Windows

# Вариант 2: Прямой запуск
python web_app.py

# Вариант 3: Через Make
make run-web

# Вариант 4: Через установленный пакет
ai-notes-webapp
```

После запуска откройте в браузере адрес http://localhost:8000

Параметры запуска:

- `--host`: Хост для запуска (по умолчанию 0.0.0.0)
- `--port`: Порт для запуска (по умолчанию 8000)

## Сборка исполняемых файлов

Для создания автономных исполняемых файлов:

```
# Вариант 1: Через скрипты
./run.sh build     # Linux/macOS
run.bat build      # Windows

# Вариант 2: Стандартная сборка
python build.py

# Вариант 3: Через Make
make build
```

Это создаст в директории `dist/` следующие файлы:

- `ai-notes-recorder` - приложение для записи
- `ai-notes-webapp` - веб-интерфейс для поиска
- Скрипты запуска для Windows/Linux/macOS

## Структура проекта

- `audio/` - директория для сохранения аудиозаписей
- `notes/` - директория для сохранения заметок
- `templates/` - директория для шаблонов веб-интерфейса
- `audio_recorder.py` - модуль для записи аудио с VAD
- `transcriber.py` - модуль для транскрибации аудио
- `search.py` - модуль для поиска по заметкам
- `recorder.py` - основной исполняемый файл
- `web_app.py` - веб-интерфейс для поиска
- `config.py` - конфигурация системы
- `build.py` - скрипт для сборки исполняемых файлов
- `setup.py` - файл для установки через pip
- `Dockerfile` - контейнеризация приложения
- `docker-compose.yml` - конфигурация Docker Compose
- `Makefile` - автоматизация задач разработки
- `run.sh` - скрипт быстрого запуска для Linux/macOS
- `run.bat` - скрипт быстрого запуска для Windows

## Дополнительные настройки

Вы можете изменить параметры системы в файле `config.py`:

- `SAMPLE_RATE` - частота дискретизации аудио (16000 Гц)
- `CHANNELS` - количество каналов (1 для моно)
- `SILENCE_THRESHOLD` - порог тишины в секундах для остановки записи (2 минуты)
- `VAD_AGGRESSIVENESS` - агрессивность детекции голоса (0-3)
- `WHISPER_MODEL` - модель Whisper для транскрибации

## Автоматизация с помощью Make

Доступные команды:

- `make help` - показать список команд
- `make setup` - настройка окружения
- `make install` - установка зависимостей
- `make run` - запуск записи
- `make run-web` - запуск веб-интерфейса
- `make build` - сборка исполняемых файлов
- `make clean` - очистка временных файлов

## Управление рекордером через веб-интерфейс

Теперь вы можете управлять рекордером непосредственно через веб-интерфейс. Эта функция объединяет поиск заметок и управление записью в одном приложении.

### Доступ к интерфейсу управления рекордером

1. Запустите веб-интерфейс, если он еще не запущен:

   ```bash
   python web_app.py
   ```

2. Откройте в браузере адрес: http://localhost:8000/recorder

### Возможности интерфейса управления рекордером

Веб-интерфейс предоставляет следующие функции:

- **Управление записью**: Кнопки для начала и остановки записи
- **Мониторинг статуса**: Отображение текущего состояния, продолжительности записи и уровня аудио
- **Настройка параметров**: Выбор модели Whisper и режима непрерывной записи
- **Просмотр последних записей**: Список последних аудиозаписей с возможностью скачивания аудио и просмотра транскрипций

### Запуск в Docker

При использовании Docker рекордер теперь интегрирован в веб-приложение:

```bash
# Запуск веб-интерфейса с интегрированным рекордером
./docker-service.sh start

# Просмотр логов
./docker-service.sh logs

# Остановка сервиса
./docker-service.sh stop
```

Для запуска автономного рекордера без веб-интерфейса:

```bash
./docker-service.sh start-standalone
```

## Устранение проблем

### Проблемы с установкой PyAudio

PyAudio требует PortAudio как системную зависимость, и часто возникают проблемы при установке:

#### macOS

1. Установите PortAudio через Homebrew:

```
brew install portaudio
```

2. Затем устанавливайте зависимости:

```
pip install -r requirements.txt
```

3. Или используйте автоматизированную команду:

```
make install-deps-macos
```

#### Ubuntu/Debian Linux

1. Установите необходимые пакеты:

```
sudo apt-get update
sudo apt-get install python3-pyaudio portaudio19-dev
```

2. Затем устанавливайте зависимости:

```
pip install -r requirements.txt
```

3. Или используйте автоматизированную команду:

```
make install-deps-linux
```

#### Windows

1. Вариант 1: Установите PyAudio через pipwin:

```
pip install pipwin
pipwin install pyaudio
```

2. Вариант 2: Скачайте подготовленный wheel-файл:

   - Перейдите на https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio
   - Скачайте соответствующий файл для вашей версии Python (например, для Python 3.9 64bit: `PyAudio‑0.2.11‑cp39‑cp39‑win_amd64.whl`)
   - Установите его: `pip install путь_к_файлу/PyAudio-0.2.11-cp39-cp39-win_amd64.whl`

3. Или просмотрите советы через команду:

```
make install-deps-windows
```

### Python не найден

- Убедитесь, что Python установлен и находится в переменной PATH
- На macOS используйте `python3` вместо `python`
- Обратите внимание, что скрипты запуска автоматически определяют доступный Python интерпретатор

### Ошибки при запуске

Если при запуске возникает ошибка `ModuleNotFoundError: No module named 'xxx'`, убедитесь, что:

1. Виртуальное окружение активировано
2. Все зависимости установлены: `pip install -r requirements.txt`
3. Зависимость не является системной (как PyAudio, требующей дополнительной установки)

### Проблемы с распознаванием голоса

- **Проблема**: VAD не определяет голос.
- **Решение**: Уменьшите значение `VAD_AGGRESSIVENESS` в `config.py`.

### Проблемы с качеством транскрибации

- **Проблема**: Плохое качество транскрипции.
- **Решение**: Используйте более точную модель Whisper (`medium` или `large`).

- **Проблема**: Высокое потребление ресурсов.
- **Решение**: Используйте менее требовательную модель Whisper (`tiny` или `base`).

### Проблемы с PyInstaller

- **Проблема**: Ошибки при сборке с PyInstaller.
- **Решение**: Обновите PyInstaller и убедитесь, что все зависимости установлены:

```
pip install --upgrade pyinstaller
pip install --upgrade -r requirements.txt
```

## Лицензия

MIT
