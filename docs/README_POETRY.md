# Работа с AI Notes через Poetry

## Что нового

Проект AI Notes теперь полностью настроен для работы с Poetry - современной системой управления зависимостями. Процесс настройки и запуска приложения существенно упростился.

## О Poetry

[Poetry](https://python-poetry.org/) - современный инструмент управления зависимостями и пакетами для Python, который объединяет управление зависимостями, виртуальными окружениями и сборкой пакетов.

## Установка Poetry

Если Poetry ещё не установлен на вашей системе, вы можете установить его следующим образом:

**Linux/macOS**:

```bash
curl -sSL https://install.python-poetry.org | python3 -
```

**Windows**:

```powershell
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -
```

После установки добавьте Poetry в PATH. На Linux/macOS обычно это:

```bash
export PATH="$HOME/.local/bin:$PATH"
```

На Windows Poetry должен быть автоматически добавлен в PATH.

## Быстрый старт

После установки Poetry, для начала работы с проектом выполните:

```bash
# Клонировать репозиторий (если ещё не сделано)
git clone <url-репозитория>
cd ai-notes

# Установить зависимости
poetry install

# Запустить все компоненты приложения
poetry run run-all
```

## Команды запуска

Вы можете запустить различные компоненты приложения с помощью следующих команд:

```bash
# Запуск всех компонентов системы (веб-интерфейс + рекордер)
poetry run run-all

# Запуск только веб-интерфейса
poetry run web

# Запуск рекордера для однократной записи
poetry run recorder

# Запуск рекордера в непрерывном режиме
poetry run recorder-continuous

# Запуск других модулей
poetry run build      # Сборка
poetry run tagging    # Тегирование
poetry run search     # Поиск
```

## Скрипты-обертки для удобства

Для удобства сохранены скрипты-обертки, которые упрощают вызов команд Poetry:

**Linux/macOS**:

```bash
# Запуск всех компонентов
./run.sh run-all

# Запуск веб-интерфейса
./run.sh web

# Запуск рекордера
./run.sh recorder
```

**Windows**:

```powershell
# Запуск всех компонентов
run.bat run-all

# Запуск веб-интерфейса
run.bat web

# Запуск рекордера
run.bat recorder
```

## Установка дополнительных зависимостей

Зависимости разделены на группы для разных функций:

```bash
# Базовые зависимости (устанавливаются автоматически при poetry install)
poetry install

# Установка зависимостей для транскрибирования аудио
poetry install --with transcription

# Установка зависимостей для функций ИИ
poetry install --with ai

# Установка всех дополнительных групп
poetry install --with transcription,ai

# Установка dev-зависимостей (pytest, black и т.д.)
poetry install --with dev
```

## Активация виртуального окружения

Если вам нужно активировать виртуальное окружение напрямую:

```bash
poetry shell
```

После этого вы можете запускать команды Python без префикса `poetry run`:

```bash
# В активированном окружении
python -m backend.web_app
```

## Добавление новых зависимостей

```bash
# Добавить основную зависимость
poetry add имя-пакета

# Добавить зависимость в группу
poetry add --group transcription имя-пакета
poetry add --group ai имя-пакета
poetry add --group dev имя-пакета
```

## Обновление зависимостей

```bash
# Обновить все зависимости
poetry update

# Обновить конкретную библиотеку
poetry update имя-пакета
```

## Предварительные требования

Некоторые функции требуют наличия внешних зависимостей:

### FFmpeg

Для транскрибирования (преобразования аудио в текст) требуется FFmpeg:

**macOS**:

```bash
brew install ffmpeg
```

**Ubuntu/Debian**:

```bash
sudo apt-get install ffmpeg
```

**Windows**:
Скачайте FFmpeg с официального сайта и добавьте в PATH.

## Структура проекта

- `pyproject.toml` - основной файл с метаданными проекта и зависимостями
- `poetry.lock` - автоматически создаваемый файл с точными версиями всех зависимостей
- `.venv/` - виртуальное окружение, создаваемое Poetry
- `backend/` - основные модули приложения
- `run.sh` / `run.bat` - скрипты-обертки для удобного запуска через Poetry
